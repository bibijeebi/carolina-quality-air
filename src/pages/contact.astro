---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const locations = [
  {
    name: "Raleigh/Cary Office",
    address: "140 Towerview Ct",
    city: "Cary, NC 27513",
    phone: "919-907-9742",
    mapUrl: "https://goo.gl/maps/uxLTf7gKZSTJfqiK8"
  },
  {
    name: "Greenville/Winterville Office",
    address: "111 Essex Dr",
    city: "Winterville, NC 28590",
    phone: "252-321-7447",
    mapUrl: "https://goo.gl/maps/arg4sqCekj4WjdP77"
  },
  {
    name: "Wilmington Office",
    address: "Wilmington Area",
    city: "Wilmington, NC",
    phone: "910-679-4471",
    mapUrl: "#"
  }
];
---

<Layout title="Contact" description="Get a free quote from Eastern NC's most trusted NADCA-certified duct cleaning experts. Serving Raleigh, Cary, Greenville, and Wilmington.">
  <Header />
  
  <main class="pt-20">
    <!-- Hero -->
    <section class="relative py-24 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white overflow-hidden">
      <div class="absolute inset-0 opacity-20">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(26,117,232,0.3),transparent_50%)]"></div>
      </div>
      
      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl">
          <span class="text-brand-400 font-semibold text-sm uppercase tracking-wider">Get In Touch</span>
          <h1 class="text-5xl sm:text-6xl font-bold mt-3 mb-6">
            Request a free quote
          </h1>
          <p class="text-xl text-slate-300 leading-relaxed">
            Fill out the form below or give us a call. We'll get back to you within 24 hours 
            to schedule your free inspection.
          </p>
        </div>
      </div>
    </section>

    <!-- Contact Form + Info -->
    <section class="py-24 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid lg:grid-cols-2 gap-16">
          <!-- Form -->
          <div>
            <h2 class="text-2xl font-bold text-slate-900 mb-8">Send us a message</h2>
            
            <form id="contactForm" class="space-y-6">
              <!-- Honeypot fields - hidden from humans, bots fill them -->
              <div class="hidden" aria-hidden="true">
                <input type="text" name="website" tabindex="-1" autocomplete="off" />
                <input type="text" name="url" tabindex="-1" autocomplete="off" />
              </div>

              <div class="grid sm:grid-cols-2 gap-6">
                <div>
                  <label for="firstName" class="block text-sm font-medium text-slate-700 mb-2">First Name *</label>
                  <input 
                    type="text" 
                    id="firstName" 
                    name="firstName" 
                    required
                    class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-600 focus:border-brand-600 transition-colors"
                  />
                </div>
                <div>
                  <label for="lastName" class="block text-sm font-medium text-slate-700 mb-2">Last Name *</label>
                  <input 
                    type="text" 
                    id="lastName" 
                    name="lastName" 
                    required
                    class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-600 focus:border-brand-600 transition-colors"
                  />
                </div>
              </div>

              <div>
                <label for="email" class="block text-sm font-medium text-slate-700 mb-2">Email *</label>
                <input 
                  type="email" 
                  id="email" 
                  name="email" 
                  required
                  class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-600 focus:border-brand-600 transition-colors"
                />
              </div>

              <div>
                <label for="phone" class="block text-sm font-medium text-slate-700 mb-2">Phone *</label>
                <input 
                  type="tel" 
                  id="phone" 
                  name="phone" 
                  required
                  class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-600 focus:border-brand-600 transition-colors"
                />
              </div>

              <div>
                <label for="propertyType" class="block text-sm font-medium text-slate-700 mb-2">Property Type *</label>
                <select 
                  id="propertyType" 
                  name="propertyType" 
                  required
                  class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-600 focus:border-brand-600 transition-colors"
                >
                  <option value="">Select property type...</option>
                  <option value="residential">Residential</option>
                  <option value="commercial">Commercial</option>
                  <option value="industrial">Industrial</option>
                  <option value="medical">Medical/Healthcare</option>
                </select>
              </div>

              <div>
                <label for="message" class="block text-sm font-medium text-slate-700 mb-2">Message</label>
                <textarea 
                  id="message" 
                  name="message" 
                  rows="4"
                  class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-600 focus:border-brand-600 transition-colors resize-none"
                  placeholder="Tell us about your project or any questions you have..."
                ></textarea>
              </div>

              <!-- Status message -->
              <div id="formStatus" class="hidden rounded-xl p-4 text-sm font-medium"></div>

              <button 
                type="submit"
                id="submitBtn"
                class="w-full inline-flex items-center justify-center gap-2 px-8 py-4 bg-brand-600 text-white font-semibold rounded-xl hover:bg-brand-700 transition-all hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span id="btnText">Send Message</span>
                <svg id="btnArrow" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
                <svg id="btnSpinner" class="hidden w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </button>
            </form>

            <script>
              const form = document.getElementById('contactForm');
              const status = document.getElementById('formStatus');
              const submitBtn = document.getElementById('submitBtn');
              const btnText = document.getElementById('btnText');
              const btnArrow = document.getElementById('btnArrow');
              const btnSpinner = document.getElementById('btnSpinner');

              form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Disable button, show spinner
                submitBtn.disabled = true;
                btnText.textContent = 'Sending...';
                btnArrow.classList.add('hidden');
                btnSpinner.classList.remove('hidden');
                status.classList.add('hidden');

                try {
                  const formData = new FormData(form);
                  const res = await fetch('https://cqa-form-handler.bennyforeman1.workers.dev', {
                    method: 'POST',
                    body: formData
                  });
                  
                  const data = await res.json();
                  
                  if (res.ok) {
                    status.textContent = data.message || 'Thank you! We\'ll be in touch soon.';
                    status.className = 'rounded-xl p-4 text-sm font-medium bg-emerald-50 text-emerald-700 border border-emerald-200';
                    form.reset();
                  } else {
                    status.textContent = data.error || 'Something went wrong. Please try again.';
                    status.className = 'rounded-xl p-4 text-sm font-medium bg-red-50 text-red-700 border border-red-200';
                  }
                } catch (err) {
                  status.textContent = 'Network error. Please call us at 252-321-7447.';
                  status.className = 'rounded-xl p-4 text-sm font-medium bg-red-50 text-red-700 border border-red-200';
                }

                // Reset button
                submitBtn.disabled = false;
                btnText.textContent = 'Send Message';
                btnArrow.classList.remove('hidden');
                btnSpinner.classList.add('hidden');
              });
            </script>
          </div>

          <!-- Contact Info -->
          <div>
            <h2 class="text-2xl font-bold text-slate-900 mb-8">Our Locations</h2>
            
            <div class="space-y-6 mb-12">
              {locations.map(loc => (
                <div class="bg-slate-50 rounded-2xl p-6">
                  <h3 class="font-bold text-slate-900 mb-2">{loc.name}</h3>
                  <a 
                    href={loc.mapUrl} 
                    target="_blank"
                    class="text-slate-600 hover:text-brand-600 transition-colors block mb-3"
                  >
                    {loc.address}<br />
                    {loc.city}
                  </a>
                  <a 
                    href={`tel:${loc.phone.replace(/-/g, '')}`}
                    class="inline-flex items-center gap-2 text-brand-600 font-semibold hover:text-brand-700 transition-colors"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                    {loc.phone}
                  </a>
                </div>
              ))}
            </div>

            <!-- Email -->
            <div class="bg-brand-50 rounded-2xl p-6">
              <h3 class="font-bold text-slate-900 mb-2">Email Us</h3>
              <a 
                href="mailto:carolinaqualityair@yahoo.com"
                class="text-brand-600 hover:text-brand-700 transition-colors"
              >
                carolinaqualityair@yahoo.com
              </a>
            </div>

            <!-- Hours -->
            <div class="mt-8 p-6 border border-slate-200 rounded-2xl">
              <h3 class="font-bold text-slate-900 mb-4">Business Hours</h3>
              <div class="space-y-2 text-slate-600">
                <div class="flex justify-between">
                  <span>Monday - Friday</span>
                  <span class="font-medium text-slate-900">8:00 AM - 5:00 PM</span>
                </div>
                <div class="flex justify-between">
                  <span>Saturday</span>
                  <span class="font-medium text-slate-900">By Appointment</span>
                </div>
                <div class="flex justify-between">
                  <span>Sunday</span>
                  <span class="text-slate-500">Closed</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Schedule Online -->
    <section class="py-24 bg-slate-50">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <span class="text-brand-600 font-semibold text-sm uppercase tracking-wider">Book Online</span>
          <h2 class="text-4xl font-bold text-slate-900 mt-3 mb-4">
            Schedule your free inspection
          </h2>
          <p class="text-lg text-slate-600">
            Pick a time that works for you. We'll confirm within 24 hours.
          </p>
        </div>
        
        <!-- Cal.com Embed -->
        <div class="bg-white rounded-3xl shadow-lg p-8">
          <div id="cal-embed" style="width:100%;height:600px;overflow:auto;">
            <!-- Cal.com inline embed loads here -->
          </div>
        </div>
      </div>
    </section>

    <!-- Cal.com Embed Script -->
    <script>
      (function (C, A, L) {
        let p = function (a, ar) { a.q.push(ar); };
        let d = C.document;
        C.Cal = C.Cal || function () {
          let cal = C.Cal;
          let ar = arguments;
          if (!cal.loaded) {
            cal.ns = {}; cal.q = cal.q || [];
            d.head.appendChild(d.createElement("script")).src = A;
            cal.loaded = true;
          }
          if (ar[0] === L) {
            const api = function () { p(api, arguments); };
            const namespace = ar[1];
            api.q = api.q || [];
            if (typeof namespace === "string") { cal.ns[namespace] = cal.ns[namespace] || api; p(cal.ns[namespace], ar); p(cal, ["initNamespace", namespace]); } else p(cal, ar);
            return;
          }
          p(cal, ar);
        };
      })(window, "https://app.cal.com/embed/embed.js", "init");

      // Initialize with your Cal.com link - UPDATE THIS with real username/event
      Cal("init", "cqa-booking", {origin:"https://cal.com"});
      Cal.ns["cqa-booking"]("inline", {
        elementOrSelector: "#cal-embed",
        calLink: "benjamin-foreman-nmetle/30min",  // Free inspection booking
        layout: "month_view",
        config: {
          theme: "light"
        }
      });
      Cal.ns["cqa-booking"]("ui", {
        theme: "light",
        styles: { branding: { brandColor: "#1a75e8" } },
        hideEventTypeDetails: false,
        layout: "month_view"
      });
    </script>

    <!-- Quick Call CTA -->
    <section class="py-16 bg-slate-900 text-white">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl font-bold mb-4">Need immediate assistance?</h2>
        <p class="text-slate-300 mb-8">Call our main office directly for the fastest response.</p>
        <a 
          href="tel:+12523217447"
          class="inline-flex items-center justify-center gap-3 px-10 py-5 bg-brand-600 text-white text-xl font-bold rounded-full hover:bg-brand-700 transition-all hover:shadow-xl"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
          </svg>
          252-321-7447
        </a>
      </div>
    </section>
  </main>

  <Footer />
</Layout>
